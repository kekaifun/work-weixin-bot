# ä¼ä¸šå¾®ä¿¡èŠå¤©æœºå™¨äºº

ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„ä¼ä¸šå¾®ä¿¡èŠå¤©æœºå™¨äººï¼Œæ”¯æŒæ¶ˆæ¯æ¥æ”¶å’Œå¤„ç†ï¼Œä»¥åŠ OpenAI API ä»£ç†åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **ä¼ä¸šå¾®ä¿¡æœºå™¨äººé›†æˆ**: å®Œæ•´æ”¯æŒä¼ä¸šå¾®ä¿¡æœºå™¨äººæ¶ˆæ¯æ¥æ”¶å’Œå“åº”
- ğŸ” **æ¶ˆæ¯åŠ å¯†è§£å¯†**: æ”¯æŒä¼ä¸šå¾®ä¿¡æ¶ˆæ¯åŠ å¯†/è§£å¯†å¤„ç†
- ğŸš€ **å¼‚æ­¥æ¶ˆæ¯å¤„ç†**: æ”¯æŒå¼‚æ­¥å“åº”æ¨¡å¼ï¼Œæå‡å¤„ç†æ•ˆç‡
- ğŸ”— **OpenAI API ä»£ç†**: å¯é€‰çš„ OpenAI API ä»£ç†åŠŸèƒ½
- âš™ï¸ **çµæ´»é…ç½®**: æ”¯æŒ YAML é…ç½®æ–‡ä»¶ï¼Œçµæ´»é…ç½®å„é¡¹å‚æ•°
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²**: æä¾› Docker æ”¯æŒï¼Œä¾¿äºéƒ¨ç½²å’Œæ‰©å±•
- ğŸ“Š **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.23+
- ä¼ä¸šå¾®ä¿¡æœºå™¨äºº Token å’Œ AES å¯†é’¥

### å®‰è£…å’Œè¿è¡Œ

1. **å…‹éš†é¡¹ç›®**
   ```bash
   git clone https://github.com/kekaifun/work-weixin-bot.git
   cd work-weixin-bot
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   go mod download
   ```

3. **é…ç½®æœºå™¨äºº**
   
   åˆ›å»ºé…ç½®æ–‡ä»¶ `config/config.yaml`ï¼š
   ```yaml
   # æœåŠ¡ç›‘å¬åœ°å€
   addr: 0.0.0.0:8099

   # ä¼ä¸šå¾®ä¿¡æœºå™¨äººé…ç½®
   wechat_bot:
     secret:
       token: your-token-here
       encoding_aes_key: your-aes-key-here
     serve_path: /wechat-bot
     backend_server:
       url: http://localhost:8099/wechat-bot
     async_response: true

   # OpenAIä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰
   openai:
     base_url: https://api.openai.com
     serve_path: /openai
   ```

4. **æ„å»ºå’Œè¿è¡Œ**
   ```bash
   # æ„å»ºé¡¹ç›®
   make build
   
   # è¿è¡Œï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
   ./bin/weixin-bot
   
   # è¿è¡Œï¼ˆæŒ‡å®šé…ç½®æ–‡ä»¶ï¼‰
   ./bin/weixin-bot --config /path/to/config.yaml
   ```

## ğŸ“¡ API æ¥å£

### ä¼ä¸šå¾®ä¿¡æœºå™¨äººæ¥å£

- **GET** `/wechat-bot` - éªŒè¯ä¼ä¸šå¾®ä¿¡æœºå™¨äºº
- **POST** `/wechat-bot` - æ¥æ”¶ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯
- **GET** `/hello` - å¥åº·æ£€æŸ¥æ¥å£

### OpenAI ä»£ç†æ¥å£ï¼ˆå¯é€‰ï¼‰

- **POST** `/openai` - OpenAI API ä»£ç†
- **OPTIONS** `/openai` - CORS é¢„æ£€è¯·æ±‚

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `addr` | string | âœ… | æœåŠ¡å™¨ç›‘å¬åœ°å€å’Œç«¯å£ |
| `wechat_bot.secret.token` | string | âœ… | ä¼ä¸šå¾®ä¿¡æœºå™¨äºº Token |
| `wechat_bot.secret.encoding_aes_key` | string | âœ… | ä¼ä¸šå¾®ä¿¡æœºå™¨äºº AES å¯†é’¥ |
| `wechat_bot.serve_path` | string | âœ… | ä¼ä¸šå¾®ä¿¡æœºå™¨äººæœåŠ¡è·¯å¾„ |
| `wechat_bot.backend_server.url` | string | âœ… | åç«¯æœåŠ¡å™¨åœ°å€ |
| `wechat_bot.async_response` | boolean | âœ… | æ˜¯å¦å¯ç”¨å¼‚æ­¥å“åº” |
| `openai.base_url` | string | âŒ | OpenAI API åŸºç¡€ URL |
| `openai.serve_path` | string | âŒ | OpenAI ä»£ç†æœåŠ¡è·¯å¾„ |

### å‘½ä»¤è¡Œå‚æ•°

```bash
./bin/weixin-bot --help
```

- `--config`: æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤: `config/config.yaml`ï¼‰

## ğŸ³ Docker éƒ¨ç½²

### æ„å»ºé•œåƒ

```bash
# æ„å»º Docker é•œåƒ
make build-image

# æ„å»º Linux é•œåƒï¼ˆå¤šå¹³å°ï¼‰
make build-linux-image
```

### è¿è¡Œå®¹å™¨

```bash
docker run -d \
  --name work-weixin-bot \
  -p 8099:80 \
  -v /path/to/config:/app/config \
  ccr.ccs.tencentyun.com/cloudmonitor/wework-weixin-bot:latest
```

### Docker Compose

```yaml
version: '3.8'
services:
  weixin-bot:
    image: ccr.ccs.tencentyun.com/cloudmonitor/wework-weixin-bot:latest
    ports:
      - "8099:80"
    volumes:
      - ./config:/app/config
    environment:
      - GO_ENV=production
    restart: unless-stopped
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ main.go                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ handlers/               # è¯·æ±‚å¤„ç†å™¨
â”‚   â”œâ”€â”€ bot.go             # æœºå™¨äººæ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ message.go         # æ¶ˆæ¯å¤„ç†
â”‚   â”œâ”€â”€ verify.go          # ç­¾åéªŒè¯
â”‚   â””â”€â”€ chatgpt/           # ChatGPT ç›¸å…³å¤„ç†
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ pkg/                   # å…¬å…±åŒ…
â”‚   â””â”€â”€ wxbizmsgcrypt/     # å¾®ä¿¡æ¶ˆæ¯åŠ å¯†åº“
â”œâ”€â”€ model/                 # æ•°æ®æ¨¡å‹
â”œâ”€â”€ bin/                   # ç¼–è¯‘è¾“å‡ºç›®å½•
â”œâ”€â”€ Dockerfile             # Docker é…ç½®
â”œâ”€â”€ makefile              # æ„å»ºè„šæœ¬
â””â”€â”€ README_CONFIG.md      # è¯¦ç»†é…ç½®è¯´æ˜
```

## ğŸ”§ å¼€å‘

### æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
go test ./...

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
go test ./handlers
```

### æ„å»º

```bash
# æœ¬åœ°æ„å»º
make build

# è·¨å¹³å°æ„å»º
GOOS=linux GOARCH=amd64 make build
```

## ğŸ“ æ—¥å¿—

ç¨‹åºè¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

- é…ç½®æ–‡ä»¶åŠ è½½çŠ¶æ€
- æœåŠ¡å¯åŠ¨ä¿¡æ¯
- æ¶ˆæ¯å¤„ç†æ—¥å¿—
- é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [ä¼ä¸šå¾®ä¿¡æœºå™¨äººå¼€å‘æ–‡æ¡£](https://developer.work.weixin.qq.com/document/path/91770)
- [Go Gin æ¡†æ¶](https://gin-gonic.com/)
- [ä¼ä¸šå¾®ä¿¡ Go SDK](https://github.com/sbzhu/weworkapi_golang)